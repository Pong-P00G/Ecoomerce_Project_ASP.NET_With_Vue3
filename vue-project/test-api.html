<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 4px; white-space: pre-wrap; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Test API</h1>
    
    <div class="container">
        <div class="card">
            <h2>Create Test Products</h2>
            <button onclick="createProducts()">Create Products</button>
            <div id="createResult" class="result"></div>
        </div>
        
        <div class="card">
            <h2>Fetch Products</h2>
            <button onclick="fetchProducts()">Fetch Products</button>
            <div id="fetchResult" class="result"></div>
        </div>
    </div>

    <script>
        const apiBase = 'https://localhost:5001/api';
        
        // Disable SSL verification for self-signed certificates
        const api = axios.create({
            baseURL: apiBase,
            httpsAgent: new https.Agent({ rejectUnauthorized: false })
        });

        async function createProducts() {
            const resultDiv = document.getElementById('createResult');
            resultDiv.innerHTML = 'Creating products...';
            resultDiv.className = 'result';
            
            const products = [
                {
                    productName: "Wireless Headphones",
                    description: "High-quality wireless headphones with noise cancellation",
                    basePrice: 99.99,
                    stock: 50,
                    minStock: 10,
                    supplier: "TechCorp",
                    isActive: true,
                    featured: true,
                    categoryNames: ["Electronics"],
                    imageUrls: ["https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&h=500&fit=crop"],
                    variants: [
                        {
                            sku: "WH-BLK-001",
                            price: 99.99,
                            stockQuantity: 25,
                            isActive: true,
                            options: [
                                { variant: "Color", value: "Black" }
                            ]
                        }
                    ]
                }
            ];

            for (const product of products) {
                try {
                    console.log('Creating product:', product.productName);
                    const response = await api.post('/products', product);
                    resultDiv.innerHTML += `\n✅ Created: ${response.data.message}`;
                    resultDiv.className = 'result success';
                } catch (error) {
                    resultDiv.innerHTML += `\n❌ Failed to create ${product.productName}: ${error.response?.data?.message || error.message}`;
                    resultDiv.className = 'result error';
                }
            }
        }

        async function fetchProducts() {
            const resultDiv = document.getElementById('fetchResult');
            resultDiv.innerHTML = 'Fetching products...';
            resultDiv.className = 'result';
            
            try {
                const response = await api.get('/products?page=1&pageSize=10&isActive=true');
                resultDiv.innerHTML = `✅ Products fetched successfully:\nTotal items: ${response.data.totalItems}\nItems: ${response.data.items.length}`;
                if (response.data.items.length > 0) {
                    resultDiv.innerHTML += `\n\nSample product: ${JSON.stringify(response.data.items[0], null, 2)}`;
                }
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML = `❌ Failed to fetch products: ${error.response?.data?.message || error.message}`;
                resultDiv.className = 'result error';
            }
        }
    </script>
    
    <!-- Import axios and https -->
    <script type="importmap">
    {
        "imports": {
            "axios": "https://cdn.jsdelivr.net/npm/axios@1.6.2/+esm"
        }
    }
    </script>
</body>
</html>